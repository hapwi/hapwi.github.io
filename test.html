<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Picks Comparison</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div class="container my-5">
        <h2 class="mb-4">Golf Picks</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th scope="col" class="text-nowrap">#</th>
                    <th scope="col" class="text-nowrap">Name</th>
                    <th scope="col" class="text-nowrap">Golfer 1</th>
                    <th scope="col" class="text-nowrap">Golfer 2</th>
                    <th scope="col" class="text-nowrap">Golfer 3</th>
                    <th scope="col" class="text-nowrap">Golfer 4</th>
                    <th scope="col" class="text-nowrap">Golfer 5</th>
                    <th scope="col" class="text-nowrap">Golfer 6</th>
                    <th scope="col" class="text-nowrap">Tiebreaker</th>
                    <th scope="col" class="text-nowrap">Total</th>
                    <th scope="col" class="text-nowrap">Worst</th>
                    <th scope="col" class="text-nowrap">Top 5</th>
                    <th scope="col" class="text-nowrap">Compare</th>
                </tr>
            </thead>
            <tbody id="golfPicksTable">
                <!-- Data will be populated here by the JavaScript -->
            </tbody>
        </table>

        <!-- Comparison Modal -->
        <div class="modal fade" id="comparisonModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Comparison</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" id="comparisonContent">
                        <!-- Comparison data will be populated here by the JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const apiKey = 'AIzaSyCTIOtXB0RDa5Y5gubbRn328WIrqHwemrc';
        const spreadsheetId2 = '1_bP0NUG6XqrF0XQvKXNm3b07QuHABfvWotsemGToyYg'; //? entires api

        async function showPlayerPicks(event, playerName) {
            event.preventDefault();

            try {
                const response1 = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId2}/values/Sheet1!A2:K?key=${apiKey}`
                );
                const data1 = await response1.json();

                const response2 = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId2}/values/PicksScores!A2:B1000?key=${apiKey}`
                );
                const data2 = await response2.json();

                if (data1.error) {
                    throw new Error(data1.error.message);
                }

                if (data2.error) {
                    throw new Error(data2.error.message);
                }

                const golferScores = {};
                data2.values.forEach(([golferName, golferScore]) => {
                    golferScores[golferName] = golferScore;
                });

                // Populate data in the table
                const tableBody = document.getElementById('golfPicksTable');
                data1.values.forEach((row, index) => {
                    const tr = document.createElement('tr');

                    tr.innerHTML = `
                <th scope="row" class="align-middle>${index + 1}</th>
                <td  class="text-nowrap align-middle">${row[0]}</td>
                <td  class="text-nowrap align-middle">${row[1]}</td>
                <td class="text-nowrap align-middle">${row[2]}</td>
                <td class="text-nowrap align-middle">${row[3]}</td>
                <td class="text-nowrap align-middle">${row[4]}</td>
                <td class="text-nowrap align-middle">${row[5]}</td>
                <td class="text-nowrap align-middle">${row[6]}</td>
                <td class="text-nowrap align-middle">${row[7]}</td>
                <td class="text-nowrap align-middle">${row[8]}</td>
                <td class="text-nowrap align-middle">${row[9]}</td>
                <td class="text-nowrap align-middle">${row[10]}</td>
                <td class="text-nowrap align-middle">
                    <input type="checkbox" class="compare-checkbox" data-name="${row[0]}">
                </td>
            `;

                    tableBody.appendChild(tr);
                });
            } catch (error) {
                console.error('Error fetching Google Sheets data:', error);
            }
        }

        // Call the function to populate data when the page loads
        document.addEventListener('DOMContentLoaded', showPlayerPicks);
        let selectedPlayers = [];

        document.addEventListener('click', function (event) {
            if (event.target.classList.contains('compare-checkbox')) {
                const playerName = event.target.getAttribute('data-name');

                if (event.target.checked) {
                    selectedPlayers.push(playerName);
                } else {
                    const index = selectedPlayers.indexOf(playerName);
                    if (index > -1) {
                        selectedPlayers.splice(index, 1);
                    }
                }

                if (selectedPlayers.length === 2) {
                    // Compare the selected players
                    comparePlayers(selectedPlayers[0], selectedPlayers[1]);

                    // Reset selections
                    document.querySelectorAll('.compare-checkbox').forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    selectedPlayers = [];
                }
            }
        });

        function comparePlayers(player1, player2) {
            // Fetch data of the two players from the table
            const tableRows = document.querySelectorAll('#golfPicksTable tr');
            let player1Data, player2Data;

            tableRows.forEach(row => {
                const playerName = row.querySelector('td').innerText;
                if (playerName === player1) {
                    player1Data = Array.from(row.querySelectorAll('td:not(:first-child)')).map(td => td
                        .innerText);

                } else if (playerName === player2) {
                    player2Data = Array.from(row.querySelectorAll('td:not(:first-child)')).map(td => td
                        .innerText);

                }
            });

            player1Data.shift();
            player2Data.shift();

            // Populate the comparison modal with data
            const comparisonContent = document.getElementById('comparisonContent');
            comparisonContent.innerHTML = `
        <div class="row">
            <div class="col-6">
                <h5>${player1}</h5>
                ${player1Data.join('<br>')}
            </div>
            <div class="col-6">
                <h5>${player2}</h5>
                ${player2Data.join('<br>')}
            </div>
        </div>
    `;

            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('comparisonModal'));
            modal.show();
        }
    </script>
</body>

</html>