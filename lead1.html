<!DOCTYPE html>
<html>

<head>
    <title>Golf Pool</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Quicksand', sans-serif;

        }

        .header {
            height: 60px;
            /* Adjust this value as needed */
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #006B54;
        }

        .header h1 {
            font-size: 5vw;
        }



        .footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: #006B54;
        }


        .header,
        .footer {
            color: #ca9800;
        }

        .btn-primary {
            margin-right: 10px;
        }
    </style>
</head>


<body>
    <header class="header">
        <div class="container text-center">
            <h1>Golf Pool</h1>
        </div>
    </header>

    <main id="content">
        <!-- We will add the table for Google Sheets data here -->
        <table id="main-table" class="data-table"></table>
    </main>
    <script>
        const apiKey = 'AIzaSyCTIOtXB0RDa5Y5gubbRn328WIrqHwemrc';
        const spreadsheetId = '1iTNStqnadp4ZyR7MRkSmvX5WeialS4WST6Yy-Qv8Reo'; //leaderboard api
        const spreadsheetId2 = '1_bP0NUG6XqrF0XQvKXNm3b07QuHABfvWotsemGToyYg'; //entires api
        const spreadsheetId3 = '1zCKMy2jgG9QoIhxFqRviDm4oxEFK_ixv_tN66GmCXTc'; //players api

        async function fetchGoogleSheetsData() {
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/Copy%20of%20Leaderboard!A1:Z?key=${apiKey}`
                );
                const data = await response.json(); //?

                if (data.error) {
                    throw new Error(data.error.message);
                }

                displayTable(data);
            } catch (error) {
                console.error('Error fetching Google Sheets data:', error);
            }
        }


        function displayTable(data) {
            const {
                values
            } = data;

            if (!values || values.length === 0) {
                console.log('No data found in the Google Sheet.');
                return;
            }

            const table = document.createElement('table');
            table.classList.add('table', 'table-striped', 'table-bordered', 'text-center', 'p-3', 'mx-auto');

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            values[0].forEach((header) => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');

            values.slice(1).forEach((row) => {
                const tableRow = document.createElement('tr');

                row.forEach((cell, index) => {
                    const td = document.createElement('td');
                    if (index === 0) {
                        td.textContent = cell;
                        td.classList.add('col-6');
                    } else if (index === 1) {
                        const divRow = document.createElement('div');
                        divRow.classList.add('d-flex', 'align-items-center');

                        const divButton = document.createElement('div');
                        const button = document.createElement('button');
                        button.textContent = 'Picks';
                        button.classList.add('btn', 'btn-primary', 'mr-3');
                        button.style.width = '80px';
                        divButton.appendChild(button);
                        divButton.classList.add('ml-auto');
                        divRow.appendChild(divButton);

                        const divData = document.createElement('div');
                        divData.textContent = cell;
                        divData.classList.add(
                        'ml-2'); // Add a left margin to create a little space before the data
                        divRow.appendChild(divData);

                        td.appendChild(divRow);
                        td.classList.add('col-6');
                    }
                    tableRow.appendChild(td);




                });

                tbody.appendChild(tableRow);
            });

            table.appendChild(tbody);

            // Create a Bootstrap card and add the table to it
            let card = document.createElement('div');
            card.classList.add('card');
            let cardBody = document.createElement('div');
            cardBody.classList.add('card-body');
            card.appendChild(cardBody);
            cardBody.appendChild(table);

            document.getElementById('content').appendChild(card);
        }

        //line 186 - 213 comment out to turn off button functionality

        async function fetchPlayerPicks(playerName) {
            try {
                const response = await fetch(

                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId2}/values/Sheet1!A:K?key=${apiKey}`
                );

                console.log('Fetch response:', response);

                const data = await response.json();
                if (data.error) {
                    throw new Error(data.error.message);
                }

                console.log('Player picks data:', data); // Add this line to log the data

                const picks = data.values.filter((row) => {
                    console.log('Checking row:', row); // Add this line to log each row being checked
                    return row[0] === playerName;
                });

                console.log('Picks for player:', playerName,
                    picks); // Add this line to log the picks found for the player

                displayPlayerPicks(data, playerName);
            } catch (error) {
                console.error('Error fetching player picks:', error);
            }
        }

        async function fetchPlayerScores(golfers) {
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId3}/values/Sheet1!A:Z?key=${apiKey}`
                );
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                console.log('Player scores data:', data); // Add this line to log the data

                displayPlayerPicksWithScores(data, golfers);
            } catch (error) {
                console.error('Error fetching player scores:', error);
            }
        }


        function displayPlayerPicksWithScores(data, golfers) {
            const picksContent = document.getElementById('picks-content');
            picksContent.innerHTML = '';

            const table = document.createElement('table');
            table.classList.add('picks-table', 'responsive-table');

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');

            const th1 = document.createElement('th');
            th1.textContent = 'Golfer';
            headerRow.appendChild(th1);

            const th2 = document.createElement('th');
            th2.textContent = 'Score';
            headerRow.appendChild(th2);

            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');

            golfers.forEach((golfer) => {
                const tableRow = document.createElement('tr');

                // Find the golfer's score in the data
                const golferRow = data.values.find((row) => row[0] === golfer);
                const golferScore = golferRow ? golferRow[1] : 'HTO';

                const td1 = document.createElement('td');
                td1.textContent = golfer;
                tableRow.appendChild(td1);

                const td2 = document.createElement('td');
                td2.textContent = golferScore;
                tableRow.appendChild(td2);

                tbody.appendChild(tableRow);
            });

            table.appendChild(tbody);
            picksContent.appendChild(table);
            document.getElementById('player-picks').style.display = 'block';
        }





        function displayPlayerPicks(data, playerName) {
            const picksContent = document.getElementById('picks-content');
            picksContent.innerHTML = '';

            const picks = data.values.filter((row) => row[0] === playerName);

            console.log('Total picks:', data.values.length);
            console.log('Picks for player:', playerName, picks);

            const list = document.createElement('ul');
            list.classList.add('golfers-list');

            picks.forEach((pick) => {
                for (let i = 1; i <= 6; i++) {
                    const listItem = document.createElement('li');
                    listItem.textContent = pick[i];
                    list.appendChild(listItem);
                }
            });

            picksContent.appendChild(list);
            document.getElementById('player-picks').style.display = 'block';

            // Get the golfer names
            const golfers = [];
            picks.forEach((pick) => {
                for (let i = 1; i <= 6; i++) {
                    golfers.push(pick[i]);
                }
            });

            // Fetch scores for the golfers
            fetchPlayerScores(golfers);
        }




        window.onload = function () {
            let closePicksElement = document.getElementById('close-picks');
            if (closePicksElement) {
                closePicksElement.addEventListener('click', () => {
                    document.getElementById('player-picks').style.display = 'none';
                });
            }
        }

        fetchGoogleSheetsData();
    </script>
    <footer class="footer" style="background-color: #006B54;">
        <nav class="navbar navbar-expand navbar-light justify-content-around">
            <a class="nav-link" href="page1.html"><i class="fas fa-trophy" style="color: #ca9800;"></i></a>
            <a class="nav-link" href="page2.html"><i class="fas fa-user" style="color: #ca9800;"></i></a>
            <a class="nav-link" href="page3.html"><i class="fas fa-list-ul" style="color: #ca9800;"></i></a>
            <a class="nav-link" href="page4.html"><i class="fas fa-edit" style="color: #ca9800;"></i></a>
        </nav>
    </footer>





    <!-- Bootstrap JS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- Custom JS -->
    <script src="main.js"></script>
</body>

</html>