<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta id="theme-color-meta" name="theme-color" content="#003e7e">
    <link href="pickem.png" rel="shortcut icon" type="image/x-icon" />
    <title>NFL Pick'em totals</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet" />
    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css"
        rel="stylesheet" />
    <!-- ? link form styles -->
    <link rel="stylesheet" href="../styles/main.css">
    <!-- <link href="../styles/form.css" rel="stylesheet" /> -->
    <!-- jQuery and jQuery UI -->
    <!-- jQuery and jQuery UI -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />



    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>

    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css">

    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js">
    </script>

    <script src="./js/PEheader-footer.js"></script>
    <!-- ? main styles -->
    <style>
        html {
            scroll-behavior: smooth;
        }

        .table-wrapper {
            overflow-x: auto;
        }

        form {
            margin-bottom: 60px;
        }

        .team-link {
            color: inherit;
            text-decoration: none;
            display: block;
            padding: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table td {
            width: 50%;
            border-right: 1px solid #dee2e6;
            /* Line separating the columns */
        }

        table td:last-child {
            border-right: none;
        }

        .selected {
            background-color: #8ecc9c;
            color: #000000;
        }

        .card2 {
            color: #000000;
            text-align: left;
        }

        .container {
            margin-bottom: 90px;
        }

        .hidden-radio {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .pt-custom {
            padding-top: 5rem !important;
            /* Adjust as needed */
            /* padding-bottom: 1rem !important; */
            /* Adjust as needed */
        }

        #myForm {
            margin-top: 2rem;
        }

        /* Navigation bar styles */
        #bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            /* height: 60px;
            background-color: var(--blue); */
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            /* Vertically align icons between middle and top */
            padding-top: 8px;
            /* Add top padding to adjust icon position */
            box-shadow: 0 -1px 5px rgba(0, 0, 0, 0.1);
            z-index: 9999;
        }

        #bottom-nav ul {
            display: flex;
            list-style: none;
            width: 100%;
            justify-content: space-around;
            padding: 0 20px;
            margin-top: 3px;
            /* Add this line to create space between <nav> and <ul> */
            background-color: var(--blue);
        }

        #bottom-nav li {
            text-align: center;
        }

        #bottom-nav a {
            display: block;
            padding: 8px;
            color: white;
            text-decoration: none;
        }

        header {
            background-color: var(--blue);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 60px;
            padding: 0;
            position: fixed;
            width: 100%;
            z-index: 9999;
        }

        .header-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        .header-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            /* needed to position the child #countdown-timer absolutely */
            width: 100%;
            height: 100%;
        }

        #countdown-timer {
            font-size: 18px;
            color: white;
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            /* shift up by half of its own height to center */
        }

        .card {
            z-index: 1;
        }

        .logo {
            font-size: 24px;
            text-decoration: none;
            color: #fff;
            display: block;
            margin: auto;
        }





        #content {
            padding-top: 80px;
        }

        /* Media queries for responsive design */
        @media (max-width: 768px) {
            header {
                height: 50px;
            }

            .logo {
                font-size: 20px;
            }
        }

        #nflTable {
            margin-bottom: 30px;
            border-collapse: separate;
            border-radius: 15px;
            overflow: hidden;
            background-color: #f9f9f9;
            border: 2px solid #ccc
        }

        #nflTable th {
            text-align: center;
            background: linear-gradient(to top, #204870, #003e7e);
            color: #fff;
            border-right: 2px solid #ccc;
        }

        #nflTable th:last-child {
            border-right: none;
        }


        #nflTable tbody tr:hover {
            background-color: #f2f2f2;
        }

        #nflTable tbody td:first-child,
        #picksTable tbody td:first-child {
            text-align: center;

        }


        #nflTable td,
        #nflTable th {
            padding: 15px;
            /* border: 1px solid #dee2e6; */
            text-align: center;


            /* Borders give a 3D, separated appearance to cells */
        }

        #picksTable th {
            text-align: center;
        }

        #picksTable td {
            text-align: center;
            vertical-align: middle;
            box-shadow: inset 0 -1px 1px rgba(0, 0, 0, 0.1);
        }

        #picksTable {
            border-collapse: separate;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #ccc;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(255, 255, 255, 0.2);
        }

        #table1 #picksTable {
            margin-top: 20px;
        }

        #table1 {
            border: 2px solid #ccc;
            box-shadow: 0 2px 5px rgba(255, 255, 255, 0.2);
            border-radius: 15px;
        }

        #table2 {
            border: 2px solid #ccc;
            box-shadow: 0 2px 5px rgba(255, 255, 255, 0.2);
            border-radius: 15px;
        }

        #picksTable th,
        #picksTable td {
            border-right: 1px solid #dee2e6;
        }

        #picksTable th:last-child,
        #picksTable td:last-child {
            border-right: none;
        }

        #picksTable thead tr:first-child th {
            border-top-left-radius: 15px;
            border-top-right-radius: 15px;
        }

        #picksTable tbody tr:last-child td {
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
        }

        .card {
            margin-bottom: 30px;
            margin-top: 15px;
        }

        #noDataMessage {
            text-align: center;
            color: red;
        }

        #weekDropdown {
            padding: 5px 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            appearance: none;
            /* this removes default browser styling */
            -webkit-appearance: none;
            /* for Safari */
            -moz-appearance: none;
            /* for Firefox */
            background-color: #f9f9f9;
            color: #333;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        #weekDropdown:hover {
            border-color: #999;

        }

        #picksTable tbody tr.matching-pick {
            background-color: rgb(90, 158, 90);
        }



        .dataTables_filter input {
            text-align: center;
            margin-bottom: 20px;
        }

        .card {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s;
        }

        .card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        #pillNav2 {
            background-color: #003e7e;
            /* The color you provided */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            color: transparent;
        }


        #pillNav2 .nav-item a.nav-link:hover,
        #pillNav2 .nav-item a.nav-link:focus {
            color: #003e7e;
            /* This sets the icon color on hover and focus to the blue you previously used */
            background-color: var(--bs-white);
            /* This sets the background color of the link on hover and focus to white */
        }

        #pillNav2 .nav-item a.nav-link.active {
            color: #003e7e;
            /* This sets the icon color for the active state to the blue you previously used */
            background-color: var(--bs-white);
            /* This sets the background color for the active state to white */
        }

        /* Bottom navigation pill styles for better distinction */
        #pillNav2 .nav-item a.nav-link {
            border: 2px solid #ffffff;
            /* Border for all pills */
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.5);
            /* Slight shadow for a raised appearance */
            transition: all 0.3s;
            /* Smooth transition for hover and active effects */
        }

        .night-mode #pillNav2 .nav-item a.nav-link {
            border: 2px solid #fff;
            /* Border for all pills */
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.5);
            /* Slight shadow for a raised appearance */
            transition: all 0.3s;
            /* Smooth transition for hover and active effects */
        }

        /* Style for the active pill to make it look pressed */
        #pillNav2 .nav-item a.nav-link.active {
            box-shadow: inset 0px 2px 5px rgba(0, 0, 0, 0.5);
            /* Inset shadow for a pressed appearance */
            border-color: #ddd;
            /* Active pill border */
        }

        /* Slight enlargement and brightening of the pill on hover */
        #pillNav2 .nav-item a.nav-link:hover {
            /* Enlarging the pill */
            border-color: #ddd;
            /* Brightened border on hover */
        }

        /* header pill styles pillnav3 header*/
        #pillNav3 {
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.5);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            letter-spacing: 2px;
            text-transform: uppercase;
            font-variant: small-caps;
            border: 2px solid #002c5a;
            background-color: #fff;
            color: #002c5a;
            font-weight: bold;

        }



        #pillNav3:hover {
            box-shadow: 0px 6px 8px rgba(0, 0, 0, 0.3);
        }


        #weekDropdown {
            text-align: center;
        }

        /* Night Mode Styles */
        body.night-mode {
            background-color: #1f1f1f;
            color: white;
        }

        .night-mode a,
        .night-mode p,
        .night-mode h1,
        .night-mode h2,
        .night-mode td,
        .night-mode th {
            color: white;
        }

        .night-mode .bg-light {
            background-color: #333 !important;
        }

        .night-mode .card-body {
            border: 1px solid #555;
        }

        .night-mode #nflTable {
            background-color: #444;
            border-color: #555;
        }

        .night-mode .alert-danger {
            background-color: #b94a48;
            border-color: #953b39;
            color: #ffffff;
        }

        .night-mode #nflTable td,
        .night-mode #nflTable th {
            background-color: #444;
            border-color: #555;
            color: white;
        }

        .night-mode #nflTable tbody tr:hover {
            background-color: #555;
        }

        .night-mode #nflTable th {
            background: #1f1f1f;
        }

        .night-mode .selected {
            background-color: #6ebf87 !important;
            color: black;
        }

        .night-mode label,
        .night-mode p {
            color: white;
        }

        /* Header and footer night mode styles */
        .night-mode header,
        .night-mode #bottom-nav {
            background-color: #1f1f1f;
        }

        .night-mode #countdown-timer {
            color: #ddd;
        }

        .night-mode #bottom-nav a,
        .night-mode #here {
            color: #ddd;
        }

        .night-mode #pillNav2 {
            background-color: #1f1f1f;
        }

        .night-mode #pillNav2 .nav-item a.nav-link:hover,
        .night-mode #pillNav2 .nav-item a.nav-link:focus {
            color: #1f1f1f;
            background-color: #ddd;
        }

        .night-mode #pillNav2 .nav-item a.nav-link.active {
            color: #1f1f1f;
            background-color: #ddd;
        }

        .night-mode #weekDropdown {
            background-color: #444;
            color: white;
        }


        .night-mode .search-label {
            color: white;
        }

        .night-mode #pillNav3 {
            border: 2px solid #fff;
            box-shadow: 0px 2px 5px rgb(90, 90, 90);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            background-color: #444;
            color: #fff;
        }




        #nightModeToggle {
            font-size: 18px;
            color: white;
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
        }
    </style>
    <!-- ? end main styles -->

    <script>
        const script = document.createElement('script');
        script.src = "../login/winners.js?v=" + new Date().getTime();
        document.head.appendChild(script);
    </script>
</head>

<body>
    <!-- ! header -->
    <header>
        <div class="header-container">
            <a href="#" id="nightModeToggle" style="color: white; text-decoration: none; margin-left: 15px;">
                <!-- <i class="bi bi-moon-fill"></i>
                <i class="bi bi-brightness-high-fill" style="display:none;"></i> -->
            </a>
            <a href="#" class="logo">
                <span class="badge rounded-pill px-4 py-2" id="pillNav3">
                    NFL Pick'em Totals
                </span>
            </a>
            <div id="countdown-timer"></div>
            <a id="countdown-timer" href="../index.html"
                style="color:var(--link-white); text-decoration: none; margin-right:15px;">
                <i class="fa-solid fa-golf-ball-tee"></i>
            </a>


        </div>
    </header>
    <!-- ? main content -->
    <div class="container" style="padding-top: 70px;">
        <!-- Add this to your HTML -->


        <div class="card bg-light rounded">


            <div class="card-body rounded" id="table1">
                <p id="noDataMessage" style="display: none; color: red; text-align: center;">User picks are not
                    available for this week.</p>
                <table id="picksTable" class="display" style="width:100%">

                    <thead>
                        <tr style="display:  none;">
                            <th></th>
                            <th></th>
                        </tr>
                        <!-- </thead> -->
                    <tbody id="picks"></tbody>

                </table>

            </div>

        </div>

        <div class="card bg-light rounded">
            <div class="card-body rounded" id="table2">
                <table id="nflTable" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>USERNAME</th>
                            <th>TOTAL</th>
                        </tr>
                    </thead>
                    <tbody id="scores"></tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- ? end of main content -->
    <!-- ! bottom nav -->
    <nav id="bottom-nav">
        <ul class="nav nav-pills nav-fill gap-2 p-1 py-3 small shadow-sm" id="pillNav2" role="tablist"
            style="--bs-nav-link-color: var(--bs-white); --bs-nav-pills-link-active-color: var(--bs-primary); --bs-nav-pills-link-active-bg: var(--bs-white);">
            <li class="nav-item" role="presentation">
                <a href="../pickem/peindex.html" id="menu-item-4" class="nav-link rounded-5">
                    <i class="bi bi-check-circle"></i>

                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="../pickem/nfltotals.html" id="menu-item-1" class="nav-link active rounded-5">
                    <i class="bi bi-list-task"></i>
                </a>
            </li>
            <li class="nav-item" role="presentation">
                <a href="../login/user-picks-login.html" id="menu-item-login" class="nav-link rounded-5">
                    <i class="bi bi-person-circle"></i>
                </a>
            </li>
        </ul>


    </nav>

    <script>
        const apiKey = 'AIzaSyCTIOtXB0RDa5Y5gubbRn328WIrqHwemrc';
        const spreadsheetId = '1iTNStqnadp4ZyR7MRkSmvX5WeialS4WST6Yy-Qv8Reo';
        let currentWeek = "5"; // Default week





        function processNflScoresData(values) {
            // Assuming the first row contains week headers, which we'll skip
            const teams = values.slice(1);

            teams.forEach(teamRow => {
                teamRow.forEach((score, colIdx) => {
                    if (score && score.trim() !==
                        "") { // If there's a score (non-empty value) for that week
                        const week = (colIdx + 1).toString(); // Convert column index to week string
                        winners[week].push(teamRow[
                            0]); // Add the team name to the corresponding week in the winners object
                    }
                });
            });

            console.log('Updated winners object array:', winners);
        }



        async function fetchGoogleSheetsData() {
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/nfl-totals!A1:B1000?key=${apiKey}`
                );
                const data = await response.json();
                console.log('Totals Data (nfl-totals):', data);


                if (data.error) {
                    throw new Error(data.error.message);
                }

                if (data.values) {
                    displayTable(data.values);
                } else {
                    console.log('No data found in the specified range.');
                }
            } catch (error) {
                console.error('Error fetching Google Sheets data:', error);
            }
        }

        // weeklywindata function shows the weekly wins the user has
        const weekRanges = {
            1: 'nfl-totals!C1:C1000',
            2: 'nfl-totals!D1:D1000',
            3: 'nfl-totals!E1:E1000',
            4: 'nfl-totals!F1:F1000',
            5: 'nfl-totals!G1:G1000',
            6: 'nfl-totals!H1:H1000',
            7: 'nfl-totals!I1:I1000',
            8: 'nfl-totals!J1:J1000',
            9: 'nfl-totals!K1:K1000',
            10: 'nfl-totals!L1:L1000',
            11: 'nfl-totals!M1:M1000',
            12: 'nfl-totals!N1:N1000',
            13: 'nfl-totals!O1:O1000',
            14: 'nfl-totals!P1:P1000',
            15: 'nfl-totals!Q1:Q1000',
            16: 'nfl-totals!R1:R1000',
            17: 'nfl-totals!S1:S1000',
            18: 'nfl-totals!T1:T1000',
        };

        async function fetchWeeklyWinData() {
            const range = weekRanges[currentWeek];
            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}&_=${new Date().getTime()}`
                );
                const data = await response.json();

                if (data.values) {
                    appendWeeklyWinToTable(data.values);
                } else {
                    console.log('No weekly win data found in the specified range.');
                }

            } catch (error) {
                console.error('Error fetching weekly win data:', error);
            }
        }

        function appendWeeklyWinToTable(weeklyWins) {
            const scoresTbody = document.getElementById('scores');
            const rows = scoresTbody.querySelectorAll('tr');

            // Remove existing weekly win data
            scoresTbody.querySelectorAll('.weekly-win-data').forEach(span => span.remove());


            // function getBackgroundColor(winValue, hueAdjustment = 0) {
            //     let hue, saturation = 100,
            //         lightness = 50;
            //     hue = Math.min(winValue, 10) * 12 + hueAdjustment;
            //     return `hsla(${hue}, ${saturation}%, ${lightness}%, 0.8)`;
            // }

            function getBackgroundColor(winValue, hueAdjustment = 0) {
                let hue, saturation = 85,
                    lightness = 50;


                if (winValue === 0) {
                    hue = 0; // Red
                    saturation = 0;
                } else if (winValue >= 1 && winValue <= 5) {
                    hue = 10; // Orange (between red and yellow)
                } else if (winValue >= 6 && winValue <= 7) {
                    hue = 30; // Yellow
                } else if (winValue >= 8 && winValue <= 9) {
                    hue = 50; // Yellowish-green
                } else if (winValue === 10) {
                    hue = 70; // A color between yellowish-green and green
                } else if (winValue >= 11 && winValue <= 12) {
                    hue = 120; // Orange (between red and yellow)
                } else {
                    hue = 120; // Green for 10 and above
                }

                hue += hueAdjustment;
                return `hsla(${hue}, ${saturation}%, ${lightness}%, 0.8)`;
            }



            weeklyWins.slice(1).forEach((win, index) => {
                if (rows[index]) {
                    const totalCell = rows[index].querySelector('td:nth-child(2)');
                    const smallTextSpan = document.createElement('span');

                    smallTextSpan.classList.add('weekly-win-data');
                    smallTextSpan.textContent = win[0];

                    const winValue = win[0] && !isNaN(win[0]) ? parseInt(win[0]) : 0;
                    smallTextSpan.style.backgroundColor = getBackgroundColor(winValue);


                    // Enhanced inline styles
                    smallTextSpan.style.fontSize = 'small';
                    smallTextSpan.style.position = 'absolute';
                    smallTextSpan.style.bottom = '5px';
                    smallTextSpan.style.right = '5px';
                    smallTextSpan.style.color = '#000';
                    smallTextSpan.style.fontWeight = 'bold';
                    smallTextSpan.style.padding = '2px 8px';
                    smallTextSpan.style.borderRadius = '100px';
                    smallTextSpan.style.fontSize = '.8rem';
                    smallTextSpan.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.3)';
                    // smallTextSpan.style.border =
                    //     '2px solid rgba(255, 255, 255, 0.5)'; // Semi-transparent white border
                    smallTextSpan.style.transition = 'transform 0.2s, box-shadow 0.2s';

                    // Hover effect
                    smallTextSpan.addEventListener('mouseover', () => {
                        smallTextSpan.style.transform = 'scale(1.1)';
                        smallTextSpan.style.boxShadow = '0 7px 20px rgba(0, 0, 0, 0.4)';
                    });

                    smallTextSpan.addEventListener('mouseout', () => {
                        smallTextSpan.style.transform = 'scale(1)';
                        smallTextSpan.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.3)';
                    });

                    // Animation for attention
                    smallTextSpan.animate([{
                            transform: 'scale(0.9)'
                        },
                        {
                            transform: 'scale(1.05)'
                        },
                        {
                            transform: 'scale(1)'
                        }
                    ], {
                        duration: 300,
                        iterations: 1
                    });

                    totalCell.style.position = 'relative';
                    totalCell.appendChild(smallTextSpan);
                }
            });



        }



        function displayTable(rows) {
            const scoresTbody = document.getElementById('scores');

            rows.slice(1).forEach(row => {
                const [username, total] = row;
                const tableRow = `
            <tr>
                <td>${username}</td>
                <td>${total}</td>
            </tr>
        `;

                scoresTbody.innerHTML += tableRow;
            });

            $(document).ready(function () {
                $('#nflTable').DataTable({
                    searching: false,
                    lengthChange: false,
                    paging: false,
                    info: false,
                    ordering: false,
                    language: {
                        emptyTable: "Your custom message for no data",
                        zeroRecords: "Your custom message when search returns zero records"
                    }

                });
            });
        }



        async function fetchPicksData(week = 5) {
            const picksTbody = document.getElementById('picks');
            picksTbody.innerHTML = ''; // Clear the table before fetching new data

            try {
                const response = await fetch(
                    `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/pemw${week}!A1:R50?key=${apiKey}`
                );
                const data = await response.json();
                console.log(`Picks Data (pemw${week}):`, data);


                if (data.error) {
                    throw new Error(data.error.message);
                }

                // If the table is already initialized with DataTables, destroy it
                if ($.fn.dataTable.isDataTable('#picksTable')) {
                    $('#picksTable').DataTable().destroy();
                }

                const noDataMessage = document.getElementById('noDataMessage');

                if (data.values && data.values.length > 1) { // Assuming the first row is headers
                    displayPicksTable(data.values);
                    initDataTable();
                    noDataMessage.style.display = "none"; // Hide the no data message
                } else {
                    noDataMessage.style.display = "block"; // Show the no data message
                }
            } catch (error) {
                console.error('Error fetching Google Sheets data:', error);
                document.getElementById('noDataMessage').style.display =
                    "block"; // Show the no data message if there's an error
            }
        }




        function addControls() {
            $('<span class="search-label" style="margin-right: 10px;">Select a username to display pick history: </span>  \
        <select id="weekDropdown" style="margin-top: 10px;">\
        <option value="1" selected>Week 1</option>\
        <option value="2">Week 2</option>\
        <option value="3">Week 3</option>\
        <option value="4">Week 4</option>\
        <option value="5">Week 5</option>\
        <option value="6">Week 6</option>\
        <option value="7">Week 7</option>\
        <option value="8">Week 8</option>\
        <option value="9">Week 9</option>\
        <option value="10">Week 10</option>\
        <option value="11">Week 11</option>\
        <option value="12">Week 12</option>\
        <option value="13">Week 13</option>\
        <option value="14">Week 14</option>\
        <option value="15">Week 15</option>\
        <option value="16">Week 16</option>\
        <option value="17">Week 17</option>\
        <option value="18">Week 18</option>\
        </select>')
                .prependTo('#picksTable_filter');

            $('#picksTable_filter label').contents().filter(function () {
                return this.nodeType === 3;
            }).remove();

            document.getElementById('weekDropdown').value = currentWeek;

            // Dropdown change event
            document.getElementById('weekDropdown').addEventListener('change', function () {
                currentWeek = this.value;

                fetchPicksData(currentWeek);
                fetchWeeklyWinData(currentWeek);
                $('#picksTable_filter')
                    .show(); // Show the DataTables search control when a new week is selected
            });
        }

        let picksTable;

        $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
                // Use the value of the search box
                let searchTerm = $('.dataTables_filter input').val();

                // Check if the search term matches the first column (username) exactly
                if (searchTerm === data[0]) {
                    return true;
                }
                return false;
            }
        );

        $(document).ready(function () {
            // Add a click event listener to each row of the nflTable
            $('#nflTable tbody').on('click', 'tr', function () {
                const noDataMessageVisible = document.getElementById('noDataMessage').style.display ===
                    "block";

                // Only proceed if the no data message isn't displayed
                if (!noDataMessageVisible) {
                    // Get the username from the first cell of the clicked row
                    let username = $(this).find('td:first').text();

                    // Set this username as the value for the picksTable DataTables search input
                    $('#picksTable_filter input').val(username);

                    // Trigger a search on the picksTable
                    $('#picksTable').DataTable().search(username).draw();

                    // Use the native CSS scrolling
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                }
            });
        });




        function initDataTable() {
            if (!$.fn.dataTable.isDataTable('#picksTable')) {
                picksTable = $('#picksTable').DataTable({
                    searching: true,
                    searchCols: [{
                        searchable: true
                    }, {
                        searchable: false
                    }],
                    search: {
                        smart: false
                    },
                    lengthChange: false,
                    paging: false,
                    info: false,
                    ordering: false,
                    columnDefs: [{
                        targets: 0, // Hide the first column
                        visible: false,
                        searchable: true
                    }],
                    drawCallback: function () {
                        var table = $('#picksTable').DataTable();
                        if (table.search() !== "") {
                            $('#picks').show();
                        } else {
                            $('#picks').hide();
                        }
                    },
                    language: {
                        emptyTable: "Picks are not available yet for this week",
                        zeroRecords: "Picks are not available yet for this week"
                    }
                });
                addControls();
                $('#picksTable_filter input').prop('readonly', true);
            }
        }


        function displayPicksTable(rows) {
            const picksTbody = document.getElementById('picks');
            picksTbody.innerHTML = ''; // Clear the previous data
            const weekWinners = winners[currentWeek] || []; // get winners for the selected week

            rows.slice(1).forEach(row => {
                const username = row[0];
                const picks = row.slice(1);

                // Loop through each pick and create a new row
                picks.forEach(pick => {
                    let isMatchingPick = weekWinners.includes(
                        pick); // Check if pick matches the winners
                    const tableRow = `
        <tr class="${isMatchingPick ? 'matching-pick' : ''}">
            <td>${username}</td>
            <td>${pick}</td>
        </tr>
    `;

                    picksTbody.innerHTML += tableRow;
                });
            });

            // If the table is already initialized, destroy it
            if ($.fn.dataTable.isDataTable('#picksTable')) {
                $('#picksTable').DataTable().destroy();
            }

            initDataTable();
            highlightMatchingPicks(); // Moved this after initDataTable
        }

        function highlightMatchingPicks() {
            const picksTable = document.getElementById('picksTable');
            const rows = picksTable.querySelectorAll('tbody tr');
            const weekWinners = winners[currentWeek] || [];

            console.log("Current Week:", currentWeek); // Log the current week
            console.log("Week's Winners:", weekWinners); // Log the winners for the week

            rows.forEach(row => {
                const pickCell = row.querySelector('td:nth-child(2)');
                if (pickCell) { // Check if pickCell exists
                    const pick = pickCell.textContent.trim();

                    console.log('Checking Pick:', pick); // Log the pick being checked

                    if (weekWinners.includes(pick)) {
                        console.log('Highlighting Pick:', pick); // Log when a match is found
                        row.classList.add('matching-pick');
                    }
                }
            });
        }

        async function fetchData() {

            await fetchGoogleSheetsData();
            await fetchPicksData();
            await fetchWeeklyWinData();
        }

        fetchData();
    </script>
    <script src="dates.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Define the current date and time
            var now = new Date();

            // Your existing code
            var currentWeek = 0;
            for (var i = 0; i < weeks.length; i++) {
                if (now.getTime() >= weeks[i].start.getTime() && now.getTime() <= weeks[i].end.getTime()) {
                    currentWeek = i;
                    break;
                }
            }

            // Get the anchor element for menu item 4
            var menuItem4 = document.getElementById('menu-item-4');

            // If the current time is within the preweek date range, handle the preweek case
            if (currentWeek === 0) {
                menuItem4.href = 'preweek.html'; // Update the href to the preweek page
            } else if (currentWeek > 0) {
                menuItem4.href = 'week' + currentWeek +
                    '.html'; // Update the href to the corresponding week's page
            } else {
                menuItem4.href = 'week' + currentWeek +
                    '.html'; // Update the href to the corresponding week's page if necessary
            }
        });

        function setThemeColor(isDarkMode) {
            const metaTag = document.getElementById('theme-color-meta');
            if (isDarkMode) {
                metaTag.setAttribute('content', '#1f1f1f');
            } else {
                metaTag.setAttribute('content', '#003e7e');
            }
        }

        function toggleIcons(isNightMode) {
            const moonIcon = document.querySelector('.bi-moon-fill');
            const sunIcon = document.querySelector('.bi-brightness-high-fill');

            if (isNightMode) {
                moonIcon.style.display = 'none';
                sunIcon.style.display = 'inline'; // or 'block' based on your design
            } else {
                moonIcon.style.display = 'inline'; // or 'block' based on your design
                sunIcon.style.display = 'none';
            }
        }

        document.getElementById('nightModeToggle').addEventListener('click', function () {
            // Toggle the night mode class
            document.body.classList.toggle('night-mode');

            const isNightMode = document.body.classList.contains('night-mode');
            setThemeColor(isNightMode);
            toggleIcons(isNightMode); // Call this to toggle the icons

            // Save to sessionStorage
            sessionStorage.setItem('night-mode', isNightMode ? 'dark' : 'light');
        });

        // Get mode setting from sessionStorage
        let darkModeSetting = sessionStorage.getItem('night-mode');

        // Default to 'light' if not set
        if (!darkModeSetting) {
            darkModeSetting = 'dark';
        }

        // Set the body class, theme color, and icons based on the setting
        if (darkModeSetting === 'dark') {
            document.body.classList.add('night-mode');
            setThemeColor(true);
            toggleIcons(true); // Set the icons based on the theme
        } else {
            document.body.classList.remove('night-mode');
            setThemeColor(false);
            toggleIcons(false); // Set the icons based on the theme
        }
    </script>
    <!-- <script src="../login/winners.js?v=1.0.2"></script> -->
    <script src="../login/common.js"></script>


</body>

</html>