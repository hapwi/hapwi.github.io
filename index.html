<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="195540.png" type="image/x-icon" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css"
    crossorigin="anonymous">

  <!-- Add Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <title>Golf Pool</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="maint.js"></script>

  <style>
    .navbar {
      position: sticky;
      top: 0;
      z-index: 9999;
    }

    .card {
      z-index: 1;
    }

    .modal-content {
      margin: 0 auto;
      max-width: 90%;
      /* Adjust this value to control the maximum width of the modal */
    }

    .modal.show {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 80px;
      /* Adjust this value according to the height of your header + desired padding */
    }

    @media (max-width: 576px) {
      .btn {
        padding: .25rem .5rem;
        font-size: .875rem;
        line-height: 1.5;
      }
    }
  </style>
</head>

<body id="leaderboard">
  <script>
    // Include your header.html file
    $("body").prepend('<div id="header-placeholder"></div>');
    $("#header-placeholder").load("header.html", function () {
      setPageTitle();
    });

    function setPageTitle() {
      var pageTitle;
      var bodyId = $('body').attr('id');

      switch (bodyId) {
        case "leaderboard":
          pageTitle = "Leaderboard";
          break;
        case "about-page":
          pageTitle = "About";
          break;
        default:
          pageTitle = "Unknown";
      }

      var logo = document.querySelector(".logo");
      logo.textContent = pageTitle;
    }
  </script>

  <main id="content" class="d-flex justify-content-center">
    <div class="card" style="width: 80%; margin-top: 20px;">
      <div class="card-body">
        <!-- <h5 class="card-title text-center">Leaderboard</h5> -->
        <div class="table-responsive">
          <table id="main-table" class="table table-striped table-bordered table-hover"></table>
        </div>
      </div>
    </div>
  </main>


  <nav id="bottom-nav">
    <ul>
      <li>
        <a href="index.html" id="menu-item-1">
          <i class="fas fa-trophy fa-bounce"></i>
          <span class="nav-text">Leaderboard</span>
        </a>
      </li>
      <li>
        <a href="players.html" id="menu-item-2">
          <i class="fas fa-user"></i>
          <span class="nav-text">Players</span>
        </a>
      </li>
      <li>
        <a href="entries.html" id="menu-item-3">
          <i class="fa-solid fa-list"></i>
          <span class="nav-text">Entries</span>
        </a>
      </li>
    </ul>
  </nav>

  <div id="player-picks" style="display:none;">
    <h2>Player Picks</h2>
    <div id="picks-content"></div>
    <!-- Add Bootstrap classes to your button -->
    <button id="close-picks" class="btn btn-primary">Close</button>
  </div>

  <!-- Add Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const apiKey = 'AIzaSyCTIOtXB0RDa5Y5gubbRn328WIrqHwemrc';
    const spreadsheetId = '1iTNStqnadp4ZyR7MRkSmvX5WeialS4WST6Yy-Qv8Reo'; //leaderboard api
    const spreadsheetId2 = '1_bP0NUG6XqrF0XQvKXNm3b07QuHABfvWotsemGToyYg'; //entires api
    const spreadsheetId3 = '1zCKMy2jgG9QoIhxFqRviDm4oxEFK_ixv_tN66GmCXTc'; //players api

    async function fetchGoogleSheetsData() {
      try {
        const response = await fetch(
          `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/Copy%20of%20Leaderboard!A1:Z?key=${apiKey}`
        );
        const data = await response.json();

        if (data.error) {
          throw new Error(data.error.message);
        }

        displayTable(data);
      } catch (error) {
        console.error('Error fetching Google Sheets data:', error);
      }
    }

    function displayTable(data) {
      const {
        values
      } = data;

      if (!values || values.length === 0) {
        console.log('No data found in the Google Sheet.');
        return;
      }

      const table = document.createElement('table');
      table.classList.add('table', 'table-striped', 'table-bordered', 'table-hover');

      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');

      values[0].forEach((header) => {
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');

      values.slice(1).forEach((row) => {
        const tableRow = document.createElement('tr');
        let playerName = null; // Initialize a variable to store the player's name

        row.forEach((cell, index) => {
          const td = document.createElement('td');

          if (index === 0) {
            playerName = cell; // Store the player's name
            const a = document.createElement('a');
            a.href = '#';
            a.textContent = cell;
            a.addEventListener('click', showPlayerPicks);
            td.appendChild(a);
          } else if (index === 1) { // second column
            const scoreDiv = document.createElement('div');
            scoreDiv.textContent = cell;
            scoreDiv.style.width = '50px'; // Set a fixed width for the div containing the score
            scoreDiv.style.textAlign = 'right'; // Align the text to the right

            const buttonDiv = document.createElement('div');
            const button = document.createElement('button');
            button.textContent = 'Picks';
            button.classList.add('btn', 'btn-primary', 'mr-2'); // Add margin to the right of the button
            button.addEventListener('click', (event) => showPlayerPicks(event,
              playerName)); // Pass the player's name as an argument
            buttonDiv.appendChild(button);

            td.classList.add('d-flex', 'justify-content-end',
              'align-items-center'); // Add Bootstrap classes for alignment and spacing
            td.appendChild(buttonDiv);
            td.appendChild(scoreDiv);
          } else {
            td.textContent = cell;
          }

          tableRow.appendChild(td);
        });

        tbody.appendChild(tableRow);
      });

      table.appendChild(tbody);
      // Replace the table inside the responsive div
      document.querySelector('.table-responsive').replaceWith(table);
    }




    async function showPlayerPicks(event, playerName) {
      event.preventDefault();

      try {
        const response1 = await fetch(
          `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId2}/values/Sheet1!A1:K?key=${apiKey}`);
        const data1 = await response1.json();
        const response2 = await fetch(
          `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId2}/values/PicksScores!A2:B1000?key=${apiKey}`
        );
        const data2 = await response2.json();

        if (data1.error) {
          throw new Error(data1.error.message);
        }

        if (data2.error) {
          throw new Error(data2.error.message);
        }

        const golferScores = {};
        data2.values.forEach(([golferName, golferScore]) => {
          golferScores[golferName] = golferScore;
        });

        displayPlayerPicks(data1, golferScores, playerName);
      } catch (error) {
        console.error('Error fetching Google Sheets data:', error);
      }
    }



    function displayPlayerPicks(data1, golferScores, playerName) {
      const {
        values: values1
      } = data1;

      if (!values1 || values1.length === 0) {
        console.log('No data found in the Google Sheet.');
        return;
      }

      const playerRow = values1.find((row) => row[0] === playerName);

      if (!playerRow) {
        console.log('No picks found for player:', playerName);
        return;
      }

      const golferNames = playerRow.slice(1, 7);

      const picksTable = document.getElementById('picks-table');
      picksTable.innerHTML = '';

      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      const th1 = document.createElement('th');
      th1.textContent = 'Golfer';
      const th2 = document.createElement('th');
      th2.textContent = 'Score';
      headerRow.appendChild(th1);
      headerRow.appendChild(th2);
      thead.appendChild(headerRow);
      picksTable.appendChild(thead);

      const tbody = document.createElement('tbody');

      golferNames.forEach((golferName) => {
        const score = golferScores[golferName] || 'N/A'; // If the golfer's score is not found, display 'N/A'

        const tableRow = document.createElement('tr');
        const td1 = document.createElement('td');
        td1.textContent = golferName;
        const td2 = document.createElement('td');
        td2.textContent = score;
        tableRow.appendChild(td1);
        tableRow.appendChild(td2);
        tbody.appendChild(tableRow);
      });

      picksTable.appendChild(tbody);

      $('#picksModal').modal('show');
    }


    document.getElementById('close-picks').addEventListener('click', () => {
      document.getElementById('player-picks').style.display = 'none';
    });

    fetchGoogleSheetsData();
  </script>
  <div class="modal fade" id="picksModal" tabindex="-1" role="dialog" aria-labelledby="picksModalLabel"
    aria-hidden="true">
    <div class="modal-dialog mx-auto" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="picksModalLabel">Player Picks</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="table-responsive">
            <table id="picks-table" class="table table-striped table-bordered table-hover"></table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>


</body>

</html>